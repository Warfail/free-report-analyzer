<!DOCTYPE html>
<html>
<head>
    <title>Free Report Analyzer</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            max-width: 1000px; 
            margin: 0 auto; 
            padding: 20px;
            background: #f5f7fa;
        }
        .container { 
            background: white; 
            padding: 25px; 
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 { color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 10px; }
        h2 { color: #34495e; }
        input, select, button, textarea { 
            padding: 12px; 
            margin: 8px 0; 
            width: 100%;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }
        button { 
            background: #3498db; 
            color: white; 
            border: none; 
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }
        button:hover { background: #2980b9; }
        .stats { 
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-box { 
            background: #ecf0f1; 
            padding: 15px; 
            border-radius: 10px;
            text-align: center;
        }
        .stat-number { 
            font-size: 28px; 
            font-weight: bold; 
            color: #2c3e50; 
        }
        .report-card { 
            background: white; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px;
            border-left: 5px solid #3498db;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .success { background: #d4edda; padding: 15px; border-radius: 8px; color: #155724; }
        .error { background: #f8d7da; padding: 15px; border-radius: 8px; color: #721c24; }
        .loading { text-align: center; padding: 20px; color: #7f8c8d; }
        #reportsContainer { max-height: 500px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>📊 Free Daily Report Analyzer</h1>
        <p>Upload daily reports from departments and get automatic analysis.</p>
        
        <div class="stats" id="stats">
            <div class="loading">Loading statistics...</div>
        </div>
    </div>
    
    <div class="container">
        <h2>📤 Upload New Report</h2>
        <select id="department">
            <option value="">Select Department</option>
            <option value="Engineering">Engineering</option>
            <option value="Marketing">Marketing</option>
            <option value="Sales">Sales</option>
            <option value="HR">Human Resources</option>
            <option value="Finance">Finance</option>
            <option value="Operations">Operations</option>
        </select>
        
        <input type="date" id="date" value="">
        
        <textarea id="reportText" placeholder="Paste your daily report here..." rows="6"></textarea>
        
        <p style="text-align: center; color: #7f8c8d;">OR upload a file:</p>
        <input type="file" id="fileInput" accept=".txt,.pdf,.docx,.doc">
        
        <button onclick="uploadReport()">📊 Upload & Analyze Report</button>
        
        <div id="uploadResult"></div>
    </div>
    
    <div class="container">
        <h2>📋 Recent Reports</h2>
        <button onclick="loadReports()" style="width: auto; padding: 10px 20px;">🔄 Refresh</button>
        <div id="reportsContainer"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000';
        
        // Set today's date as default
        document.getElementById('date').value = new Date().toISOString().split('T')[0];
        
        // Load stats on page load
        loadStats();
        loadReports();
        
        async function loadStats() {
            try {
                const response = await fetch(`${API_URL}/api/stats`);
                const data = await response.json();
                
                document.getElementById('stats').innerHTML = `
                    <div class="stat-box">
                        <div class="stat-number">${data.total_reports}</div>
                        <div>Total Reports</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number">${data.total_departments}</div>
                        <div>Departments</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number">${data.today_reports}</div>
                        <div>Today's Reports</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number">✅</div>
                        <div>System Active</div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading stats:', error);
                document.getElementById('stats').innerHTML = 
                    '<div class="error">⚠️ Backend not running. Start backend first!</div>';
            }
        }
        
        async function uploadReport() {
            const department = document.getElementById('department').value;
            const date = document.getElementById('date').value;
            const reportText = document.getElementById('reportText').value;
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!department) {
                showResult('Please select a department', 'error');
                return;
            }
            
            if (!reportText && !file) {
                showResult('Please enter report text or select a file', 'error');
                return;
            }
            
            const formData = new FormData();
            formData.append('department', department);
            formData.append('date', date);
            
            if (file) {
                formData.append('file', file);
            } else {
                // Create a text file from textarea
                const textFile = new Blob([reportText], { type: 'text/plain' });
                formData.append('file', textFile, 'report.txt');
            }
            
            showResult('Uploading and analyzing...', 'loading');
            
            try {
                const response = await fetch(`${API_URL}/api/upload`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showResult(`
                        <strong>✅ ${result.message}</strong><br><br>
                        <strong>Department:</strong> ${result.department}<br>
                        <strong>Words:</strong> ${result.word_count}<br>
                        <strong>Summary:</strong> ${result.summary}
                    `, 'success');
                    
                    // Clear form
                    document.getElementById('reportText').value = '';
                    fileInput.value = '';
                    
                    // Refresh data
                    loadStats();
                    loadReports();
                } else {
                    showResult(`Error: ${result.error}`, 'error');
                }
            } catch (error) {
                showResult(`Network error: ${error.message}<br>Make sure backend is running at ${API_URL}`, 'error');
            }
        }
        
        async function loadReports() {
            const container = document.getElementById('reportsContainer');
            container.innerHTML = '<div class="loading">Loading reports...</div>';
            
            try {
                const response = await fetch(`${API_URL}/api/reports`);
                const data = await response.json();
                
                if (data.reports.length === 0) {
                    container.innerHTML = '<div class="report-card">No reports yet. Upload the first one!</div>';
                    return;
                }
                
                let html = '';
                data.reports.forEach(report => {
                    html += `
                        <div class="report-card">
                            <strong>${report.department}</strong> - ${report.report_date}<br>
                            <div style="color: #666; margin: 5px 0;">${report.summary}</div>
                            <small>📝 ${report.word_count} words • 📅 ${new Date(report.upload_date).toLocaleDateString()}</small>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            } catch (error) {
                container.innerHTML = `<div class="error">Error loading reports: ${error.message}</div>`;
            }
        }
        
        function showResult(message, type) {
            const resultDiv = document.getElementById('uploadResult');
            resultDiv.innerHTML = `<div class="${type}">${message}</div>`;
            
            // Auto-clear success messages after 5 seconds
            if (type === 'success') {
                setTimeout(() => {
                    resultDiv.innerHTML = '';
                }, 5000);
            }
        }
        
        // Auto-refresh stats every 30 seconds
        setInterval(loadStats, 30000);
    </script>
</body>
</html>